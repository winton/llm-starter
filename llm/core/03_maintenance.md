# Prompt 03 – Maintenance Loop (Knowledge + Release Prep)

SYSTEM:
You are a senior staff engineer driving continuous code health and release readiness.

USER:
Run the **Maintenance Loop** below to keep the knowledge base current **and** prepare any recently finished epic for release.

---
## Maintenance Loop

1. **Synthesize Knowledge**
   * **Goal**: To produce a high-level, factual, and verifiable summary of the project's current state.
   * **Process**:
     1. Ingest all source code (skip `llm/`, `tests/`, and other non-source paths from `llm/llm.config.yaml`).
     2. Read existing docs in `docs/` and the `knowledge/` directory.
     3. Based on the code, update or create the following files in the `knowledge/` directory:
        * `knowledge/SYSTEM_OVERVIEW.md`: A high-level description of the main components and how they interact.
        * `knowledge/DATA_MODELS.md`: A summary of the key data structures, database schemas, or API objects used in the project.
        * `knowledge/DEPENDENCY_GRAPH.md`: A list or diagram showing the dependencies between major modules or services.
     4. If you identify a significant architectural decision that is not yet documented, create a new ADR file in `knowledge/adr/` using the template from `llm/ADR_TEMPLATE.md`.
   * Capture diffs for any modified files. If nothing changed, note `Knowledge base is up to date.`

2. **Check for Completed Epic**
   * Look at `docs/EPICS.md` and `llm/todos.yaml`.
   * If an epic’s tasks are **all** `completed`, treat the epic as *finished* and run the Release Prep sequence (step 3). Otherwise, skip to step 4.

3. **Release Prep Sequence** *(only when a finished epic is detected)*
   1. **Run Code-Health Scan** – call `llm/projects/code-health/prompts/01_code_health_scan.md`; append security, bugfix, and refactor tasks to `llm/todos.yaml`.
   2. **Run Doc-Sync** – call `llm/projects/doc-sync/prompts/01_doc_sync_scan.md`; append drift tasks to `llm/todos.yaml`.
   3. **Generate Changelog Stub** – build a changelog section summarising the epic’s changes and write (or append) to `CHANGELOG.md`.

4. **Next Steps**
   * If the Release Prep sequence added tasks to `llm/todos.yaml`, instruct the operator to resume the Feature Implementation Loop (running `02a` through `02d`) until the backlog is clear.
   * If no release-prep tasks were added and the knowledge base is current, output `Maintenance complete :sparkles:`

---
## Output Requirements

Return **one** of the following:

1. The diffs for updated files in `knowledge/` and/or `CHANGELOG.md` *plus* a summary list of any backlog tasks generated by the release-prep scans.
2. The text `Maintenance complete :sparkles:` if nothing required updating.

---
## Constraints

* Only modify files inside `knowledge/`, `CHANGELOG.md`, or append tasks to `llm/todos.yaml`.
* Do **not** directly fix code; let the Feature Implementation Loop handle new backlog tasks.
* Keep explanations concise; focus on actionable outputs. 